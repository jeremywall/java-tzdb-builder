name: Build Latest TZDB

on:
  workflow_dispatch:
  push:
    branches:
      - main
#  schedule:
#    - cron: '0 0 * * *'

# $JAVA_HOME/lib/tzdb.dat

jobs:
  check:
    name: Check if newer version available
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Fetch latest version number from IANA
        run: wget https://data.iana.org/time-zones/tzdb/version
      - name: Print versions
        run: echo "Latest IANA `cat version` and Last processed version `cat last-processed-version`"
      - name: Check if versions are different
        run: |
          diff version last-processed-version > /dev/null 2>&1
          diff_result = $?
          if [ $diff_result -eq 0 ]
          then
            # versions are the same so nothing to do
            echo "same"
          elif [ $diff_result -eq 1 ]
          then
            # versions are NOT the same
            echo "diff"
          else
            # there was an error
            echo "error"
          fi
  build:
    name: Build
    runs-on: ubuntu-latest
    needs: check
    steps:
      - run: echo $JAVA_HOME
#      - run: which java
#      - run: which javac
#      - run: java -version
#      - run: javac -version
#      - run: head $JAVA_HOME/lib/tzdb.dat
#      - run: wget -O- https://apt.corretto.aws/corretto.key | sudo apt-key add - 
#      - run: sudo add-apt-repository 'deb https://apt.corretto.aws stable main'
#      - run: sudo apt-get update
#      - run: sudo apt-get install -y java-17-amazon-corretto-jdk
#      - run: ls -la /usr/lib/jvm/java-17-amazon-corretto
#      - run: sudo update-alternatives --set java "/usr/lib/jvm/java-17-amazon-corretto/bin/java"
#      - run: sudo update-alternatives --set javac "/usr/lib/jvm/java-17-amazon-corretto/bin/javac"
#      - run: export JAVA_HOME=/usr/lib/jvm/java-17-amazon-corretto
#      - run: wget https://data.iana.org/time-zones/tzdb/version
#      - run: cat version